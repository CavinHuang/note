"use strict";(self.webpackChunkcavin_huang_note=self.webpackChunkcavin_huang_note||[]).push([[640],{9280:(n,s,a)=>{a.r(s),a.d(s,{data:()=>t});const t={key:"v-a86b728a",path:"/vue/vue3%E8%B5%B7%E6%89%8B%E5%BC%8F/createApp%E5%88%9B%E5%BB%BA%E8%BF%87%E7%A8%8B%E8%A7%A3%E6%9E%90.html",title:"createApp创建过程解析",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"起步",slug:"起步",children:[{level:3,title:"初始化一个vue3项目",slug:"初始化一个vue3项目",children:[]}]},{level:2,title:"createApp的过程",slug:"createapp的过程",children:[{level:3,title:"createApp源码分析",slug:"createapp源码分析",children:[]},{level:3,title:"ensureRenderer",slug:"ensurerenderer",children:[]},{level:3,title:"baseCreateRenderer",slug:"basecreaterenderer",children:[]},{level:3,title:"createAppApi",slug:"createappapi",children:[]}]},{level:2,title:"总结",slug:"总结",children:[]}],filePathRelative:"vue/vue3起手式/createApp创建过程解析.md",git:{updatedTime:1643101595e3,contributors:[{name:"CavinHuang",email:"sujinw@qq.com",commits:1}]}}},1356:(n,s,a)=>{a.r(s),a.d(s,{default:()=>K});var t=a(6252),e=a(1590),o=a(7952),p=a(4714);const c=(0,t._)("h1",{id:"createapp创建过程解析",tabindex:"-1"},"createApp创建过程解析",-1),l=(0,t._)("h2",{id:"起步",tabindex:"-1"},"起步",-1),k=(0,t._)("h3",{id:"初始化一个vue3项目",tabindex:"-1"},"初始化一个vue3项目",-1),u=(0,t._)("p",null,"首先，我们用vite创建一个简单的vue3的项目",-1),_=(0,t._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,t._)("pre",{class:"language-bash"},[(0,t._)("code",null,[(0,t._)("span",{class:"token function"},"yarn"),(0,t.Uk)(" create vite my-vue-app --template vue\n")])]),(0,t._)("div",{class:"line-numbers"},[(0,t._)("span",{class:"line-number"},"1"),(0,t._)("br")])],-1),r=(0,t._)("p",null,[(0,t.Uk)("我们都知道的vue3基础用法，比如以下 "),(0,t._)("code",null,"main.js"),(0,t.Uk)(" 的内容")],-1),i=(0,t._)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t._)("pre",{class:"language-javascript"},[(0,t._)("code",null,[(0,t._)("span",{class:"token keyword"},"import"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" createApp "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"from"),(0,t.Uk)(),(0,t._)("span",{class:"token string"},"'vue'"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token keyword"},"import"),(0,t.Uk)(" App "),(0,t._)("span",{class:"token keyword"},"from"),(0,t.Uk)(),(0,t._)("span",{class:"token string"},"'./App.vue'"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(" app "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"createApp"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("App"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\napp"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"mount"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'#app'"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token comment"},"// 组件渲染和未捕获错误配置的处理程序"),(0,t.Uk)("\napp"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("config"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function-variable function"},"errorHandler"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("err"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" vm"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" info")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token comment"},"// 添加全局属性"),(0,t.Uk)("\napp"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("config"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("globalProperties"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function-variable function"},"$http"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t._)("span",{class:"token comment"},"// 这里相当于挂载到Vue2的 Vue.prototype"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token comment"},"// 指定一种方法识别Vue之外定义的自定义元素"),(0,t.Uk)("\napp"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("config"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function-variable function"},"isCustomElement"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token parameter"},"tag"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(" tag"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"startsWith"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'ion-'"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token comment"},"// 注册组件"),(0,t.Uk)("\napp"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"component"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'my-component'"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token comment"},"// 检索组件"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(" MyComponent "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(" app"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"component"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'my-component'"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token comment"},"// 注册指令"),(0,t.Uk)("\napp"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"directive"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'my-directive'"),(0,t._)("span",{class:"token punctuation"},","),(0,t._)("span",{class:"token punctuation"},"{"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token comment"},"// 设置一个可以注入到应用程序内所有组件中的值。组件应使用inject来接收提供的值。"),(0,t.Uk)("\napp"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"provide"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'user'"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token string"},"'administrator'"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token comment"},"// 卸载应用程序"),(0,t.Uk)("\n app"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"unmount"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token comment"},"// 安装vue插件"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token keyword"},"import"),(0,t.Uk)(" MyPlugin "),(0,t._)("span",{class:"token keyword"},"from"),(0,t.Uk)(),(0,t._)("span",{class:"token string"},"'./plugins/MyPlugin'"),(0,t.Uk)("\napp"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"use"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("MyPlugin"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token operator"},"..."),(0,t.Uk)("\n")])]),(0,t._)("div",{class:"line-numbers"},[(0,t._)("span",{class:"line-number"},"1"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"2"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"3"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"4"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"5"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"6"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"7"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"8"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"9"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"10"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"11"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"12"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"13"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"14"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"15"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"16"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"17"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"18"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"19"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"20"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"21"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"22"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"23"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"24"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"25"),(0,t._)("br")])],-1),U=(0,t._)("p",null,"那么createApp是做了什么呢，是怎么样把虚拟DOM转换成真实DOM的呢？",-1),b=(0,t._)("h2",{id:"createapp的过程",tabindex:"-1"},"createApp的过程",-1),m=(0,t._)("p",null,[(0,t.Uk)("首先放一张完整的流程图，先有一个印象： "),(0,t._)("img",{src:e,alt:"createApp整个流程"})],-1),d=(0,t._)("h3",{id:"createapp源码分析",tabindex:"-1"},"createApp源码分析",-1),f=(0,t._)("p",null,"分析过程请看如下代码注释",-1),v=(0,t._)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t._)("pre",{class:"language-javascript"},[(0,t._)("code",null,[(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(" createApp "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t._)("span",{class:"token operator"},"..."),(0,t.Uk)("args")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token comment"},"// 核心方法 调用vue实例创建方法创建app实例"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(" app "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"ensureRenderer"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"createApp"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token operator"},"..."),(0,t.Uk)("args"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("process"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("env"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token constant"},"NODE_ENV"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"!=="),(0,t.Uk)(),(0,t._)("span",{class:"token string"},"'production'"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token comment"},"// 用于注入native标签"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token function"},"injectNativeTagCheck"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("app"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token comment"},"// 注入用户自己的自定义标签"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token function"},"injectCompilerOptionsCheck"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("app"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" mount "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(" app"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token comment"},"// app实例的挂载方法 对应 app.mount('#app') 接受的是我们传入需要挂载的选择器"),(0,t.Uk)("\n  app"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function-variable function"},"mount"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},"containerOrSelector"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token comment"},"// 拿到选择器的节点 此处拿到的是 HTMLElement "),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(" container "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"normalizeContainer"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("containerOrSelector"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token operator"},"!"),(0,t.Uk)("container"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"return"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token comment"},"// 此处是实例化的 App组件"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(" component "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(" app"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("_component"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token operator"},"!"),(0,t._)("span",{class:"token function"},"isFunction"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("component"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"&&"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"!"),(0,t.Uk)("component"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("render "),(0,t._)("span",{class:"token operator"},"&&"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"!"),(0,t.Uk)("component"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("template"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token comment"},"// __UNSAFE__"),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token comment"},"// Reason: potential execution of JS expressions in in-DOM template."),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token comment"},"// The user must make sure the in-DOM template is trusted. If it's"),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token comment"},"// rendered by the server, the template should not contain any user data."),(0,t.Uk)("\n      component"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("template "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(" container"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("innerHTML"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token comment"},"// 在挂载之前 先清空容器的内容"),(0,t.Uk)("\n    container"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("innerHTML "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token string"},"''"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token comment"},"// 调用 createVNode 返回一个响应式的 vnode"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(" proxy "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"mount"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("container"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token boolean"},"false"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" container "),(0,t._)("span",{class:"token keyword"},"instanceof"),(0,t.Uk)(),(0,t._)("span",{class:"token class-name"},"SVGElement"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("container "),(0,t._)("span",{class:"token keyword"},"instanceof"),(0,t.Uk)(),(0,t._)("span",{class:"token class-name"},"Element"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      container"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"removeAttribute"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'v-cloak'"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n      container"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"setAttribute"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'data-v-app'"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token string"},"''"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token keyword"},"return"),(0,t.Uk)(" proxy"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"return"),(0,t.Uk)(" app"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n")])]),(0,t._)("div",{class:"line-numbers"},[(0,t._)("span",{class:"line-number"},"1"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"2"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"3"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"4"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"5"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"6"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"7"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"8"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"9"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"10"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"11"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"12"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"13"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"14"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"15"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"16"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"17"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"18"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"19"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"20"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"21"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"22"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"23"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"24"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"25"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"26"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"27"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"28"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"29"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"30"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"31"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"32"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"33"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"34"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"35"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"36"),(0,t._)("br")])],-1),y=(0,t._)("p",null,"通过上面源码解析，我们可以看出 createApp 主要是干了两件事：",-1),h=(0,t._)("ul",null,[(0,t._)("li",null,[(0,t._)("p",null,"创建 app 实例，并返回该实例")]),(0,t._)("li",null,[(0,t._)("p",null,"重写 mount 方法")])],-1),w=(0,t._)("p",null,"看完会存在两个主要疑问，ensureRenderer 是干啥用的？为什么要重写 mount 方法，而不直接使用呢？",-1),g=(0,t._)("p",null,[(0,t.Uk)("此处我们首先看看 传入 "),(0,t._)("code",null,"args"),(0,t.Uk)(":")],-1),C=(0,t._)("p",null,[(0,t._)("img",{src:o,alt:"createApp 接受的参数 args"})],-1),S=(0,t._)("p",null,[(0,t.Uk)("实例化后的app具有的方法包含，"),(0,t._)("code",null,"app.component()"),(0,t.Uk)(" 挂载组件方法、 "),(0,t._)("code",null,"app.config"),(0,t.Uk)(" 全局配置属性、"),(0,t._)("code",null,"app.mixin()"),(0,t.Uk)(" 挂载mixin方法、"),(0,t._)("code",null,"app.provide()"),(0,t.Uk)("根部注入属性方法、"),(0,t._)("code",null,"app.use()"),(0,t.Uk)("挂载插件的方法、"),(0,t._)("code",null,"app.mount()"),(0,t.Uk)("实例挂载节点容器方法、"),(0,t._)("code",null,"app.unmount()"),(0,t.Uk)(" 卸载方法")],-1),x=(0,t._)("p",null,[(0,t._)("img",{src:p,alt:"createApp app实例"})],-1),A=(0,t._)("h3",{id:"ensurerenderer",tabindex:"-1"},"ensureRenderer",-1),R=(0,t._)("p",null,"用于创建渲染器，渲染器核心代码处于 runtime-core/src/renderer.ts 文件。看看ensureRenderer().createApp 做了哪些操作:",-1),N=(0,t._)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t._)("pre",{class:"language-javascript"},[(0,t._)("code",null,[(0,t.Uk)("baseCreateRenderer"),(0,t._)("span",{class:"token comment"},"// 可以看出render存在2种类型的渲染器"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token keyword"},"let"),(0,t.Uk)(" renderer"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" Renderer"),(0,t._)("span",{class:"token operator"},"<"),(0,t.Uk)("Element"),(0,t._)("span",{class:"token operator"},">"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"|"),(0,t.Uk)(" HydrationRenderer\n\n"),(0,t._)("span",{class:"token comment"},"// 延迟创建渲染器，当用户只是使用reactive响应库，可以做tree-shaking优化"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"ensureRenderer"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"return"),(0,t.Uk)(" renderer "),(0,t._)("span",{class:"token operator"},"||"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("renderer "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"createRenderer"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("rendererOptions"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token comment"},"// 基础渲染器"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"createRenderer"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},"options"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"baseCreateRenderer"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("options"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token comment"},"// HydrationRenderer渲染器，也是只在调用的时候创建，方便做tree-shaking优化"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"createHydrationRenderer"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("options"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" RendererOptions"),(0,t._)("span",{class:"token operator"},"<"),(0,t.Uk)("Node"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" Element"),(0,t._)("span",{class:"token operator"},">")]),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"baseCreateRenderer"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("options"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" createHydrationFunctions"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t._)("div",{class:"line-numbers"},[(0,t._)("span",{class:"line-number"},"1"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"2"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"3"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"4"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"5"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"6"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"7"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"8"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"9"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"10"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"11"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"12"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"13"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"14"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"15"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"16"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"17"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"18"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"19"),(0,t._)("br")])],-1),V=(0,t._)("p",null,"到此处发现 baseCreateRenderer才是真容。 从分析可以看出：",-1),E=(0,t._)("ul",null,[(0,t._)("li",null,[(0,t._)("p",null,"存在 2 种类型的渲染器，它们都是基于 baseCreateRenderer 函数创建，此函数存在重载。")]),(0,t._)("li",null,[(0,t._)("p",null,"渲染器都是通过延迟创建，方便不使用的时候做 tree-shaking。")])],-1),P=(0,t._)("h3",{id:"basecreaterenderer",tabindex:"-1"},"baseCreateRenderer",-1),j=(0,t._)("p",null,"创建渲染器的实例，渲染器核心创建逻辑，包含创建组件实例、挂载实例、对比、更新、移除等操作，总体源码如下，先粗略的看下整个过程，后面再深入到具体的作用",-1),I=(0,t._)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t._)("pre",{class:"language-javascript"},[(0,t._)("code",null,[(0,t._)("span",{class:"token comment"},"// implementation"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"baseCreateRenderer"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("options"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" createHydrationFns")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token comment"},"// 一些运行时的准备"),(0,t.Uk)("\n  ···\n\n  "),(0,t._)("span",{class:"token comment"},"// dom操作方法的封装"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" \n    "),(0,t._)("span",{class:"token comment"},"// 插入"),(0,t.Uk)("\n    insert"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" hostInsert"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" \n    "),(0,t._)("span",{class:"token comment"},"// 移除"),(0,t.Uk)("\n    remove"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" hostRemove"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" \n    "),(0,t._)("span",{class:"token comment"},"// 对比属性"),(0,t.Uk)("\n    patchProp"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" hostPatchProp"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" \n    "),(0,t._)("span",{class:"token comment"},"// 无论什么情况都会执行的对比方法"),(0,t.Uk)("\n    forcePatchProp"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" hostForcePatchProp"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" \n    "),(0,t._)("span",{class:"token comment"},"// 创建元素"),(0,t.Uk)("\n    createElement"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" hostCreateElement"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" \n    "),(0,t._)("span",{class:"token comment"},"// 创建文本节点"),(0,t.Uk)("\n    createText"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" hostCreateText"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" \n    "),(0,t._)("span",{class:"token comment"},"// 创建注释"),(0,t.Uk)("\n    createComment"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" hostCreateComment"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" \n    "),(0,t._)("span",{class:"token comment"},"// 设置文本"),(0,t.Uk)("\n    setText"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" hostSetText"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" \n    "),(0,t._)("span",{class:"token comment"},"// 设置节点的文本"),(0,t.Uk)("\n    setElementText"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" hostSetElementText"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" \n    "),(0,t._)("span",{class:"token comment"},"// 指定父节点"),(0,t.Uk)("\n    parentNode"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" hostParentNode"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" 、\n    "),(0,t._)("span",{class:"token comment"},"// 指定下一个兄弟的节点"),(0,t.Uk)("\n    nextSibling"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" hostNextSibling"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" \n    "),(0,t._)("span",{class:"token comment"},"// 设置css scoped"),(0,t.Uk)("\n    setScopeId"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" hostSetScopeId "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token constant"},"NOOP"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" \n    "),(0,t._)("span",{class:"token comment"},"// 克隆一个节点"),(0,t.Uk)("\n    cloneNode"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" hostCloneNode"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" \n    "),(0,t._)("span",{class:"token comment"},"// 插入静态节点的内容"),(0,t.Uk)("\n    insertStaticContent"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" hostInsertStaticContent \n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(" options"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// vue的diff过程叫做patch过程，这个方法是核心，整个渲染过程的核心方法"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"patch"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("n1"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" n2"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" container"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" anchor "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"null"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentComponent "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"null"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentSuspense "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"null"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" isSVG "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token boolean"},"false"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" slotScopeIds "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"null"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" optimized "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token boolean"},"false")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 文本内容节点处理方法"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"processText"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("n1"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" n2"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" container"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" anchor")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 处理注释节点"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"processCommentNode"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("n1"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" n2"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" container"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" anchor")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 处理静态节点"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"mountStaticNode"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("n2"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" container"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" anchor"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" isSVG")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 创建或者更新静态节点"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"patchStaticNode"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("n1"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" n2"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" container"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" isSVG")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 移动静态节点"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"moveStaticNode"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" el"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" anchor "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" container"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" nextSibling")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 删除静态节点"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"removeStaticNode"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" el"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" anchor "),(0,t._)("span",{class:"token punctuation"},"}")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 处理element节点"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"processElement"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("n1"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" n2"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" container"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" anchor"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentComponent"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentSuspense"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" isSVG"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" slotScopeIds"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" optimized")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 挂载element节点"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"mountElement"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("vnode"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" container"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" anchor"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentComponent"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentSuspense"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" isSVG"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" slotScopeIds"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" optimized")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 生成设置 scpoed id"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"setScopeId"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("el"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" scopeId"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" slotScopeIds"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentComponent")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 挂载更新子节点"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"mountChildren"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("children"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" container"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" anchor"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentComponent"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentSuspense"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" isSVG"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" slotScopeIds"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" optimized"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" start "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token number"},"0")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 更新element"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"patchElement"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("n1"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" n2"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentComponent"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentSuspense"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" isSVG"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" slotScopeIds"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" optimized")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 更新一个节点块的子节点"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"patchBlockChildren"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("oldChildren"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" newChildren"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" fallbackContainer"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentComponent"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentSuspense"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" isSVG"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" slotScopeIds")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 更新属性"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"patchProps"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("el"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldProps"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" newProps"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentComponent"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentSuspense"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" isSVG")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 处理 fragment"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"processFragment"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("n1"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" n2"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" container"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" anchor"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentComponent"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentSuspense"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" isSVG"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" slotScopeIds"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" optimized")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 处理 组件"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"processComponent"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("n1"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" n2"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" container"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" anchor"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentComponent"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentSuspense"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" isSVG"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" slotScopeIds"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" optimized")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 挂载组件"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"mountComponent"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("initialVNode"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" container"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" anchor"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentComponent"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentSuspense"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" isSVG"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" optimized")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 更新组件"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"updateComponent"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("n1"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" n2"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" optimized")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 运行带有副作用的render函数"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"setupRenderEffect"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("instance"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" initialVNode"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" container"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" anchor"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentSuspense"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" isSVG"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" optimized")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 组件预渲染"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"updateComponentPreRender"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("instance"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" nextVNode"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" optimized")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 更新子节点"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"patchChildren"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("n1"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" n2"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" container"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" anchor"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentComponent"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentSuspense"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" isSVG"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" slotScopeIds"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" optimized "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token boolean"},"false")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 更新没有带key的子节点"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"patchUnkeyedChildren"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("c1"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" c2"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" container"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" anchor"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentComponent"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentSuspense"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" isSVG"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" slotScopeIds"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" optimized")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// diff，数组子节点发生变更，主要是，更新、删除、添加、移动几种方式处理"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"patchKeyedChildren"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("c1"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" c2"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" container"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentAnchor"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentComponent"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentSuspense"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" isSVG"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" slotScopeIds"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" optimized")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 移动或插入子节点"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"move"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("vnode"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" container"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" anchor"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" moveType"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentSuspense "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"null")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 卸载"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"unmount"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("vnode"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentComponent"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentSuspense"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" doRemove "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token boolean"},"false"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" optimized "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token boolean"},"false")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 移除节点"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"remove"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token parameter"},"vnode"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 移除 fragment"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"removeFragment"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("cur"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" end")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 卸载所有子组件"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"unmountComponent"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("instance"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentSuspense"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" doRemove")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 卸载所有的子节点"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"unmountChildren"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("children"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentComponent"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentSuspense"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" doRemove "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token boolean"},"false"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" optimized "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token boolean"},"false"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" start "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token number"},"0")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 获取下一个节点"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"getNextHostNode"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token parameter"},"vnode"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token comment"},"// 渲染和挂载的流程"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t._)("span",{class:"token function-variable function"},"render"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("vnode"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" container"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" isSVG")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token comment"},"// 没有vnode，直接卸载内容"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("vnode "),(0,t._)("span",{class:"token operator"},"=="),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"null"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("container"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("_vnode"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t._)("span",{class:"token function"},"unmount"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("container"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("_vnode"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"null"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"null"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token boolean"},"true"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token comment"},"// 创建或更新组件"),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token function"},"patch"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("container"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("_vnode "),(0,t._)("span",{class:"token operator"},"||"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"null"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" container"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"null"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"null"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"null"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" isSVG"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token comment"},"// 缓存vnode"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token function"},"flushPostFlushCbs"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    container"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("_vnode "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(" vnode"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(" internals "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    p"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" patch"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    um"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" unmount"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    m"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" move"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    r"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" remove"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    mt"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" mountComponent"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    mc"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" mountChildren"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    pc"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" patchChildren"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    pbc"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" patchBlockChildren"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    n"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" getNextHostNode"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    o"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" options\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"let"),(0,t.Uk)(" hydrate"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"let"),(0,t.Uk)(" hydrateNode"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("createHydrationFns"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token punctuation"},"["),(0,t.Uk)("hydrate"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" hydrateNode"),(0,t._)("span",{class:"token punctuation"},"]"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"createHydrationFns"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("internals"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      render"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n      hydrate"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n      createApp"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"createAppAPI"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("render"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" hydrate"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t._)("div",{class:"line-numbers"},[(0,t._)("span",{class:"line-number"},"1"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"2"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"3"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"4"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"5"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"6"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"7"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"8"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"9"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"10"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"11"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"12"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"13"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"14"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"15"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"16"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"17"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"18"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"19"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"20"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"21"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"22"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"23"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"24"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"25"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"26"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"27"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"28"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"29"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"30"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"31"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"32"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"33"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"34"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"35"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"36"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"37"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"38"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"39"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"40"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"41"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"42"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"43"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"44"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"45"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"46"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"47"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"48"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"49"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"50"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"51"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"52"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"53"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"54"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"55"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"56"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"57"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"58"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"59"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"60"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"61"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"62"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"63"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"64"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"65"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"66"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"67"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"68"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"69"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"70"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"71"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"72"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"73"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"74"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"75"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"76"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"77"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"78"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"79"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"80"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"81"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"82"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"83"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"84"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"85"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"86"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"87"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"88"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"89"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"90"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"91"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"92"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"93"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"94"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"95"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"96"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"97"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"98"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"99"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"100"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"101"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"102"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"103"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"104"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"105"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"106"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"107"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"108"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"109"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"110"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"111"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"112"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"113"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"114"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"115"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"116"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"117"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"118"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"119"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"120"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"121"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"122"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"123"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"124"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"125"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"126"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"127"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"128"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"129"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"130"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"131"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"132"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"133"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"134"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"135"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"136"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"137"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"138"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"139"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"140"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"141"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"142"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"143"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"144"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"145"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"146"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"147"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"148"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"149"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"150"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"151"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"152"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"153"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"154"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"155"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"156"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"157"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"158"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"159"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"160"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"161"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"162"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"163"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"164"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"165"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"166"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"167"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"168"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"169"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"170"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"171"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"172"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"173"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"174"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"175"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"176"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"177"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"178"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"179"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"180"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"181"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"182"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"183"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"184"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"185"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"186"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"187"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"188"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"189"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"190"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"191"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"192"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"193"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"194"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"195"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"196"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"197"),(0,t._)("br")])],-1),G=(0,t._)("p",null,"可以看出 baseCreateRenderer 主要实现了：",-1),z=(0,t._)("ul",null,[(0,t._)("li",null,[(0,t._)("p",null,"实现了组件渲染的创建、更新、卸载等核心逻辑（后续解读）")]),(0,t._)("li",null,[(0,t._)("p",null,"返回渲染函数，以及创建应用实例方法，当然还有 hydrate。")])],-1),H=(0,t._)("p",null,"渲染对比更新逻辑，非常庞大，后面打算分步骤的逐一阅读，此处先关注总体的创建逻辑",-1),T=(0,t._)("h3",{id:"createappapi",tabindex:"-1"},"createAppApi",-1),M=(0,t._)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t._)("pre",{class:"language-javascript"},[(0,t._)("code",null,[(0,t._)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"createAppAPI"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},"render"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"createApp"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("rootComponent"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" rootProps "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"null")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token comment"},"// rootComponent 就是上面打印的 createApp函数的args参数，也就是options"),(0,t.Uk)("\n\n    "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(" context "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"createAppContext"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(" app "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("context"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("app "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      _uid"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" uid$"),(0,t._)("span",{class:"token number"},"1"),(0,t._)("span",{class:"token operator"},"++"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n      _component"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" rootComponent"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n      _props"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" rootProps"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n      _container"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"null"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n      _context"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(" context"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token keyword"},"get"),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"config"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t._)("span",{class:"token keyword"},"return"),(0,t.Uk)(" context"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("config\n      "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token keyword"},"set"),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"config"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},"v"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n\n      "),(0,t._)("span",{class:"token comment"},"// 这里加载插件，和vue2不同的是，vue2的插件是全局的，这里只针对一个vue实例"),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token function"},"use"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("plugin"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"..."),(0,t.Uk)("options")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n\n      "),(0,t._)("span",{class:"token comment"},"// 混入"),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token function"},"mixin"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},"mixin"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},"{"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n\n      "),(0,t._)("span",{class:"token comment"},"// 加载组件"),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token function"},"component"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},"mixin"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},"{"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n\n      "),(0,t._)("span",{class:"token comment"},"// 指令"),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token function"},"directive"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("name"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" directive")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},"{"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n\n      "),(0,t._)("span",{class:"token comment"},"// 挂载，核心渲染逻辑"),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token function"},"mount"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("rootContainer"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" isHydrate")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},"{"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n\n      "),(0,t._)("span",{class:"token comment"},"// 卸载"),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token function"},"unmount"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},"{"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n\n      "),(0,t._)("span",{class:"token comment"},"// 注入"),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token function"},"provide"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},"{"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t._)("div",{class:"line-numbers"},[(0,t._)("span",{class:"line-number"},"1"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"2"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"3"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"4"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"5"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"6"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"7"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"8"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"9"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"10"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"11"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"12"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"13"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"14"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"15"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"16"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"17"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"18"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"19"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"20"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"21"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"22"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"23"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"24"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"25"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"26"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"27"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"28"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"29"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"30"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"31"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"32"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"33"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"34"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"35"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"36"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"37"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"38"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"39"),(0,t._)("br")])],-1),O=(0,t._)("p",null,"从上面的代码，我们可以了解到 createAppAPI 主要实现了：",-1),B=(0,t._)("ul",null,[(0,t._)("li",null,[(0,t._)("p",null,"创建定义一个实例上下文 context，包含属性和方法")]),(0,t._)("li",null,[(0,t._)("p",null,"重写扩展 context.app 方法，实现用户可以对上下文相关属性的自定义操作，也就是应用实例暴露的 api 实现，比如自定义指令、混入 mixin、组件等提供用户自定义实现。")]),(0,t._)("li",null,[(0,t._)("p",null,"根据根组件和属性在 mount 方法中完成虚拟节点 vNode 的转换，并通过 render 喊完成渲染，关于渲染函数在 baseCreateRender 已经说过。")])],-1),F=(0,t._)("p",null,"上面代码中的 mount 就是此篇的重点：",-1),D=(0,t._)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t._)("pre",{class:"language-javascript"},[(0,t._)("code",null,[(0,t._)("span",{class:"token comment"},"// 挂载，核心渲染逻辑"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token function-variable function"},"mount"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("rootContainer"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" isHydrate")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token comment"},"// 判断是否已挂载"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token operator"},"!"),(0,t.Uk)("isMounted"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token comment"},"// 创建虚拟节点"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token keyword"},"const"),(0,t.Uk)(" vnode "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"createVNode"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("rootComponent"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" rootProps"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n\n    "),(0,t._)("span",{class:"token comment"},"// 在根VNode上存储应用程序context"),(0,t.Uk)("\n    vnode"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("appContext "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(" context\n\n    "),(0,t._)("span",{class:"token comment"},"// 将虚拟节点渲染成真实dom"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token function"},"render"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("vnode"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" rootContainer"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n\n    isMounted "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t._)("span",{class:"token boolean"},"true"),(0,t.Uk)("\n    app"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("_container "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(" rootContainer\n    rootContainer"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("__vue_app__ "),(0,t._)("span",{class:"token operator"},"="),(0,t.Uk)(" app\n    "),(0,t._)("span",{class:"token keyword"},"return"),(0,t.Uk)(" vnode"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("component"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("proxy\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t._)("div",{class:"line-numbers"},[(0,t._)("span",{class:"line-number"},"1"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"2"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"3"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"4"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"5"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"6"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"7"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"8"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"9"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"10"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"11"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"12"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"13"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"14"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"15"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"16"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"17"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"18"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"19"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"20"),(0,t._)("br"),(0,t._)("span",{class:"line-number"},"21"),(0,t._)("br")])],-1),L=(0,t._)("h2",{id:"总结",tabindex:"-1"},"总结",-1),q=(0,t._)("p",null,[(0,t.Uk)("最后再来一次这张图 "),(0,t._)("img",{src:e,alt:"createApp整个流程"})],-1),Z=(0,t._)("p",null,"至此分析了 createApp 大致的流程，内部更细致的实现，后续再根据内容深入分析，这里再总结下整个过程。",-1),$=(0,t._)("ul",null,[(0,t._)("li",null,[(0,t._)("p",null,"执行 createApp 首先会创建渲染器，这里要注意的是存在 2 种渲染器类型，并且它们都是通过延迟创建的，主要目的是当用户只引用 reactive 响应式框架的时候，方便进行 tree-shaking 优化。且两种渲染器都是基于 baseCreateRender 方法来实现。")]),(0,t._)("li",null,[(0,t._)("p",null,"baseCreateRender 函数执行后会返回 render -渲染函数和 createApp 方法，其中 render 函数是组件创建、更新和卸载的主要核心逻辑实现。createApp 则用于创建应用实例，进行应用实例的初始化。")]),(0,t._)("li",null,[(0,t._)("p",null,"createAppAPI 用于生成默认的应用上下文 context，这里定义了应用实例具备的属性和方法，并通过重写扩展 context.app 属性，让用户能够进行对上下文的自定义操作，比如自定义组件、指令、mixin、插件安装等一系列操作。并存在 mount 方法完成将根组件转为虚拟节点 vNode，并通过render 函数完成对 vNode 的渲染。")])],-1),J={},K=(0,a(3744).Z)(J,[["render",function(n,s){return(0,t.wg)(),(0,t.iD)(t.HY,null,[c,l,k,u,_,r,i,U,b,m,d,f,v,y,h,w,g,C,S,x,A,R,N,V,E,P,j,I,G,z,H,T,M,O,B,F,D,L,q,Z,$],64)}]])},3744:(n,s)=>{s.Z=(n,s)=>{const a=n.__vccOpts||n;for(const[n,t]of s)a[n]=t;return a}},1590:(n,s,a)=>{n.exports=a.p+"assets/img/all.0d520345.jpg"},4714:(n,s,a)=>{n.exports=a.p+"assets/img/app-instance.68b112d0.png"},7952:(n,s,a)=>{n.exports=a.p+"assets/img/createApp.a53d9ed2.png"}}]);