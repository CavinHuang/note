(()=>{window.onerror=function(e,a,s,t,n){window.parent.postMessage({type:"console",method:"string",data:[e,a,s,t,n].map((e=>handleData(e)))})},window.addEventListener("unhandledrejection",(e=>{window.parent.postMessage({type:"console",method:"string",data:[handleData(e.reason.stack)]})}));const type=e=>Object.prototype.toString.call(e).slice(8,-1).toLowerCase(),stringify=(e,a,s,t)=>{let n=type(e),o="",r=0,c=s?"":",";switch(n){case"object":if(t.includes(e))o+='<span class="string">检测到循环引用</span>';else{t.push(e);let s=Object.keys(e);r=s.length,r<=0?o+=a?`<span class="bracket">{ }${c}</span>`:`<div class="bracket">{ }${c}</div>`:(o+='<span class="el-icon-arrow-right expandBtn"></span>',o+=a?'<span class="bracket">{</span>':'<div class="bracket">{</div>',o+='<div class="wrap">',s.forEach(((a,s)=>{let n=["object","array"].includes(type(e[a]));o+=`\n                                <div class="object">\n                                    <span class="key">"${a}"</span>\n                                    <span class="colon">:</span>\n                                    ${stringify(e[a],!0,s>=r-1,t)}${s<r-1&&!n?",":""}\n                                </div>`})),o+="</div>",o+=`<div class="bracket">}${c}</div>`)}break;case"array":t.includes(e)?o+='<span class="string">检测到循环引用</span>':(t.push(e),r=e.length,r<=0?o+=a?`<span class="bracket">[ ]${c}</span>`:`<div class="bracket">[ ]${c}</div>`:(o+='<span class="el-icon-arrow-right expandBtn"></span>',o+=a?'<span class="bracket">[</span>':'<div class="bracket">[</div>',o+='<div class="wrap">',e.forEach(((e,a)=>{o+=`\n                            <div class="array">\n                                ${stringify(e,!0,a>=r-1,t)}${a<r-1?",":""}\n                            </div>`})),o+="</div>",o+=`<div class="bracket">]${c}</div>`));break;default:let s=handleData(e),n="string"===s.contentType?'"':"";o+=`<span class="${s.contentType}">${n}${s.content}${n}</span>`}return o},handleData=e=>{let a=type(e);switch(a){case"boolean":e=e?"true":"false";break;case"null":e="null";break;case"undefined":e="undefined";break;case"symbol":case"function":e=e.toString();break;case"array":case"object":e=stringify(e,!1,!0,[],!0)}return{contentType:a,content:e}};let countIndex={};sessionStorage.getItem("CONSOLE_COUNT")&&(countIndex=JSON.parse(sessionStorage.getItem("CONSOLE_COUNT")));let timeData={};const handleArgs=(e,a)=>{if(a.length>0&&"string"===type(a[0])){let e=a[0].match(/(%[sdifc])([^%]*)/gm);if(e){let s=a.slice(1),t=[];e.forEach(((e,a)=>{let n=e.slice(0,2),o=s[a];if(void 0===o)return void t.push(e);let r="";switch(n){case"%s":r=String(o)+e.slice(2);break;case"%d":case"%i":r=("number"===type(o)?parseInt(o):"NaN")+e.slice(2);break;case"%f":r=("number"===type(o)?o:"NaN")+e.slice(2);break;case"%c":r=`<span style="${o}">${e.slice(2)}</span>`}t.push(r)})),a=t,s.length>e.length&&(a=a.concat(s.slice(e.length)))}}switch(e){case"assert":a[0]?a=null:(e="error",a=["Assertion failed: "+(a[1]||"console.assert")]);break;case"count":a[0]?(void 0!==countIndex[a[0]]?countIndex[a[0]]++:countIndex[a[0]]=1,sessionStorage.setItem("CONSOLE_COUNT",JSON.stringify(countIndex)),a=[a[0]+": "+countIndex[a[0]]]):a=null;break;case"time":timeData[a[0]]=Date.now(),a=null;break;case"timeEnd":a=timeData[a[0]]?[a[0]+": "+(Date.now()-timeData[a[0]])+" ms"]:null}return{method:e,args:a}};function ProxyConsole(){}["debug","clear","error","info","log","warn","dir","props","group","groupEnd","dirxml","table","trace","assert","count","markTimeline","profile","profileEnd","time","timeEnd","timeStamp","groupCollapsed"].forEach((e=>{let a=console[e];ProxyConsole.prototype[e]=function(...s){let t=handleArgs(e,s);t.args&&window.parent.postMessage({type:"console",method:t.method,data:t.args.map((e=>handleData(e)))}),a.apply(ProxyConsole,s)}})),window.console=new ProxyConsole;const onMessage=({data={}})=>{if("command"===data.type)try{console.log("＞ "+data.data),console.log(eval(data.data))}catch(e){console.error("js执行出错"),console.error(e)}else"log_info"===data.type?console.log(data.data):"log_error"===data.type&&console.error(data.data)};window.addEventListener("message",onMessage)})();